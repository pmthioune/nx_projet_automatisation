' Create a new module in the VBA editor and paste this code
Option Explicit

' Adds a custom tab and button to Excel ribbon
Sub AddRibbon()
    Dim cb As CommandBar
    Dim btn As CommandBarButton
    
    On Error Resume Next
    Set cb = Application.CommandBars("Worksheet Menu Bar")
    On Error GoTo 0
    
    If Not cb Is Nothing Then
        Set btn = cb.Controls.Add(Type:=msoControlButton, Temporary:=True)
        btn.Caption = "Apply Conditional Formatting"
        btn.OnAction = "ApplyConditionalFormatting"
    End If
End Sub

' Function to apply conditional formatting
Sub ApplyConditionalFormatting()
    Dim ws As Worksheet
    Dim rng As Range
    Dim cf As FormatCondition
    
    Set ws = ActiveSheet
    On Error Resume Next
    Set rng = Application.Selection
    On Error GoTo 0
    
    If rng Is Nothing Then
        MsgBox "Please select a range before applying conditional formatting.", vbExclamation
        Exit Sub
    End If
    
    ' Clear existing conditional formats
    rng.FormatConditions.Delete
    
    ' Apply a rule: highlight cells greater than a threshold
    Set cf = rng.FormatConditions.Add(Type:=xlCellValue, Operator:=xlGreater, Formula1:=50)
    cf.Interior.Color = RGB(255, 0, 0) ' Red background
    
    ' Apply a rule: highlight cells less than a threshold
    Set cf = rng.FormatConditions.Add(Type:=xlCellValue, Operator:=xlLess, Formula1:=20)
    cf.Interior.Color = RGB(0, 255, 0) ' Green background
    
    ' Apply a rule: highlight cells between two values
    Set cf = rng.FormatConditions.Add(Type:=xlCellValue, Operator:=xlBetween, Formula1:=30, Formula2:=40)
    cf.Interior.Color = RGB(255, 255, 0) ' Yellow background
    
    MsgBox "Conditional formatting applied successfully!", vbInformation
End Sub

' Macro to ask for the current year and update text cells in multiple sheets
Sub UpdateYearInSheets()
    Dim ws As Worksheet
    Dim yearValue As String
    
    yearValue = InputBox("Entrez l'année en cours :", "Mise à jour de l'année")
    If yearValue = "" Then Exit Sub ' Cancel action if no input
    
    For Each ws In ThisWorkbook.Sheets
        ws.Cells.Replace What:="{YEAR}", Replacement:=yearValue, LookAt:=xlPart, MatchCase:=False
    Next ws
    
    MsgBox "Mise à jour terminée !", vbInformation
End Sub
